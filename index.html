<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="">

  <title>Hangman</title>

  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css" integrity="sha384-PsH8R72JQ3SOdhVi3uxftmaW6Vc51MKb0q5P2rRUpPvrszuE4W1povHYgTpBfshb" crossorigin="anonymous">

  <!-- Custom styles for this template -->
  <link href="./assets/style.css" rel="stylesheet">
</head>

<body>

  <div class="container">
    <main role="main">
      <div class="jumbotron">
        <h1 class="display-3">Hangman</h1>
        <div class="row">
          <div class="col">
            <canvas id="canvas" width="300" height="300">
              Sorry, your browser doesn't support the &lt;canvas&gt; element.
            </canvas>
          </div>
          <div class="col">
            <p class="lead" id="theWord"></p>
            <p><a onclick="startGame()" class="btn btn-lg btn-success" href="#" role="button">New Game</a></p>
          </div>
        </div>
      </div>
    </main>
  </div> <!-- /container -->

  <script>
    var mysteryWord = "initial";
    var knownWord = [];
    var tries = 6;
    var gameIsActive = false;
    var c = document.getElementById("canvas");
		var ctx = c.getContext("2d");

    // Setup hangman drawing
    // base
    ctx.moveTo(10,250);
    ctx.lineTo(100,250);
    // rope
    ctx.moveTo(100,10);
    ctx.lineTo(100,30);
    // pole
    ctx.moveTo(10,10);
    ctx.lineTo(10,250);
    // top
    ctx.moveTo(10,10);
    ctx.lineTo(150,10);
    ctx.stroke();

    // When user clicks New Game button
    function startGame() {
      ctx.clearRect(15,29,220,220);
      tries = 6;
      knownWord = [];
      mysteryWord = prompt("Enter the word you want people to guess");

      if(mysteryWord !== null || mysteryWord !== "") {
        gameIsActive = true;
        createEmptySpacesForKnownWord();
        updateLabel();
      }
    }

    function updateLabel() {
      document.getElementById("theWord").innerHTML = knownWord.join(' ');
    }

    // Primary game logic
    document.onkeyup = function(event) {
      if(gameIsActive && !wordComplete()) {
        var letter = String.fromCharCode(event.keyCode).toLowerCase();
        if(wordContains(letter)) {
          updateLabel();
        } else {
          tries--;
          updateHangman(tries);
          if(tries <= 0) {
            gameIsActive = false;
          }
        }
      }
    }

    function updateHangman(tries) {
      switch (tries) {
        case 5:
          // head
          ctx.beginPath();
          ctx.arc(100, 65, 35, 0, 2 * Math.PI);
          ctx.stroke();
          break;
        case 4:
          // body
          ctx.moveTo(100,100);
          ctx.lineTo(100,180);
          ctx.stroke();
          break;
        case 3:
          // left leg
          ctx.moveTo(100,180);
          ctx.lineTo(70,230);
          ctx.stroke();
          break;
        case 2:
          // right leg
          ctx.moveTo(100,180);
          ctx.lineTo(130,230);
          ctx.stroke();
          break;
        case 1:
          // left arm
          ctx.moveTo(100,100);
          ctx.lineTo(70,150);
          ctx.stroke();
          break;
        case 0:
          // right arm
          ctx.moveTo(100,100);
          ctx.lineTo(130,150);
          ctx.stroke();
          break;
      }
    }

    function wordComplete() {
      for (var i = 0; i < knownWord.length; i++) {
        // If we ever see a _, the user hasn't guessed all the letters
        if(knownWord[i] === '_') {
          return false;
        }
      }
      gameIsActive = false;
      return true;
    }

    function createEmptySpacesForKnownWord(word) {
      for (var i = 0; i < mysteryWord.length; i++) {
        knownWord.push('_');
      }
    }

    function wordContains(char) {
      var containsLetterFlag = false
      for (var i = 0; i < mysteryWord.length; i++) {
        // if submitted char is same as mysteryWord[i]
        if (char === mysteryWord.charAt(i)) {
          // fill knownWord slot with the char
          knownWord[i] = char;
          containsLetterFlag = true;
        }
      }
      return containsLetterFlag;
    }
  </script>
</body>
</html>
